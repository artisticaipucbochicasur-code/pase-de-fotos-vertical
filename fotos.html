<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Swiper iOS Test - Reales</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
  <style>
    html, body {
      height: 100%;
      margin: 0;
      overflow: hidden;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior: none;
      background: #000;
    }
    .swiper {
      width: 100vw;
      height: 100vh;
      overscroll-behavior: contain;
      touch-action: pan-y;
      -webkit-overflow-scrolling: touch;
      background: #000;
    }
    .swiper-slide {
      display: flex;
      align-items: center;
      justify-content: center;
      background: #000;
    }
    .swiper-slide img {
      width: 100%;
      height: auto;
      object-fit: contain;
      user-select: none;
      -webkit-user-drag: none;
      touch-action: pan-y pinch-zoom;
    }
    #loader {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 18px;
      font-family: sans-serif;
      z-index: 10;
    }
  </style>
</head>
<body>
  <div class="swiper">
    <div class="swiper-wrapper"></div>
  </div>

  <div id="loader">Cargando...</div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwyY6m3H8WD494cnoQbNXwspsZtD1sGu97yio9mk9DTozGSuyo6gHXB1W6HArcpYfP2/exec";
let swiperInstance = null;
let anunciosData = [];
const loader = document.getElementById('loader');
const comentariosPorAnuncio = {};

async function cargarImagenes() {
  loader.style.display = 'block';
  try {
    const response = await fetch(`${SCRIPT_URL}?accion=listarAnuncios`);
    const data = await response.json();
    let newAnunciosData = [];

    if (data.url && data.url.length > 0) {
      data.url.forEach((url, i) => {
        const id = data.id[i];
        newAnunciosData.push({
          titulo: data.titulo[i] || "",
          descripcion: data.descripcion[i] || "",
          url: url,
          id: id || ""
        });
      });
    }

    newAnunciosData.reverse();
    anunciosData = newAnunciosData;

    const wrapper = document.querySelector('.swiper-wrapper');
    wrapper.innerHTML = '';

    anunciosData.forEach(a => {
      const slide = document.createElement('div');
      slide.classList.add('swiper-slide');
      const img = document.createElement('img');
      img.src = a.url;
      img.alt = a.titulo;
      slide.appendChild(img);
      wrapper.appendChild(slide);
    });

    if (!swiperInstance) {
      swiperInstance = new Swiper('.swiper', {
        direction: 'vertical',
        loop: true,
        slidesPerView: 1,
        spaceBetween: 8,
        simulateTouch: true,
        touchStartPreventDefault: false
      });
    } else {
      swiperInstance.update();
    }
  } catch (e) {
    console.error(e);
  } finally {
    loader.style.display = 'none';
  }
}

// =============================
// ðŸš« BLOQUEAR PULL-TO-REFRESH EN iOS
// =============================

// Este mÃ©todo funciona a nivel global, no solo dentro del swiper
(function bloquearPullToRefresh() {
  let lastY = 0;
  document.addEventListener('touchstart', function (e) {
    if (e.touches.length !== 1) return;
    lastY = e.touches[0].clientY;
  }, { passive: true });

  document.addEventListener('touchmove', function (e) {
    if (e.touches.length !== 1) return;
    const y = e.touches[0].clientY;
    const deltaY = y - lastY;
    const atTop = (document.scrollingElement.scrollTop === 0);
    if (atTop && deltaY > 0) {
      // evita que Safari haga refresh
      e.preventDefault();
    }
  }, { passive: false });
})();

// =============================
// Ejecutar carga
// =============================
cargarImagenes();
</script>

</body>
</html>


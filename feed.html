<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>DECOM</title>

  <!-- FontAwesome (igual que tus páginas) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    html, body { height: 100%; margin: 0; background:#000; overflow:hidden; font-family: Arial, sans-serif; }
    #socialHeader {
      position: fixed; top: 0; left: 0; width: 100%;
      background: linear-gradient(135deg,
        rgba(10,10,20,.98) 0%,
        rgba(20,10,35,.92) 50%,
        rgba(5,15,25,.95) 100%);
      backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
      z-index: 999999;
      padding: 8px 0;
      box-shadow: 0 2px 4px rgba(0,0,0,.4);
    }
    .header-content{
      display:flex; justify-content:space-between; align-items:center;
      max-width:1200px; margin:0 auto; padding:0 12px;
    }
    .header-content h1{ color:#fff; font-size:1.4rem; margin:0; letter-spacing:1px; }
    .header-buttons{ display:flex; gap:8px; align-items:center; }
    .header-btn{
      background: rgba(255,255,255,.1);
      color:#fff; border:none; border-radius:50%;
      width:36px; height:36px;
      display:flex; align-items:center; justify-content:center;
      font-size:1.1rem;
      transition: background .2s, transform .15s, box-shadow .2s;
      cursor:pointer;
    }
    .header-btn:hover{ background: rgba(255,255,255,.2); transform: scale(1.06); box-shadow:0 0 8px rgba(255,255,255,.2); }
    .header-btn.selected{
      background:#fff; color:#111;
      box-shadow:0 0 6px rgba(255,255,255,.5);
    }

    /* Zona de contenido debajo del header */
    #content {
      position: fixed;
      top: 54px; /* altura header aproximada */
      left: 0; right: 0; bottom: 0;
      background:#000;
    }

    .viewframe{
      position:absolute; inset:0;
      width:100%; height:100%;
      border:0;
      background:#000;
    }
    .hidden{ display:none; }
  </style>
</head>

<header id="socialHeader">
  <div class="header-content">
    <h1 id="feedTitle">DECOM</h1>

    <div class="header-buttons">
      <!-- Tabs -->
      <button id="tabFotos" class="header-btn selected" title="Imágenes">
        <i class="fas fa-image"></i>
      </button>

      <button id="tabVideos" class="header-btn" title="Videos">
        <i class="fas fa-video"></i>
      </button>

      <!-- Acciones de FOTOS (se ven solo en modo fotos) -->
      <div id="actionsFotos" style="display:flex; gap:10px; align-items:center;">
        <button id="feedPublishBtnFotos" class="header-btn" title="Publicar">
          <i class="fas fa-plus-circle"></i>
        </button>

        <button id="feedBuscarBtnFotos" class="header-btn" title="Buscar">
          <i class="fas fa-search"></i>
        </button>

        <div id="feedUserBtnFotos"
             title="Usuario"
             style="background:#0077cc;color:white;width:40px;height:40px;border-radius:50%;
                    display:flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer;user-select:none;">
          U
        </div>
      </div>

      <!-- Acciones de VIDEOS (se ven solo en modo videos) -->
      <div id="actionsVideos" style="display:none; gap:10px; align-items:center;">
        <button id="feedPublishBtnVideos" class="header-btn" title="Publicar">
          <i class="fas fa-plus-circle"></i>
        </button>

        <button id="feedBuscarBtnVideos" class="header-btn" title="Buscar">
          <i class="fas fa-search"></i>
        </button>

        <div id="feedUserBtnVideos"
             title="Usuario"
             style="background:#0077cc;color:white;width:40px;height:40px;border-radius:50%;
                    display:flex;align-items:center;justify-content:center;font-weight:bold;cursor:pointer;user-select:none;">
          U
        </div>
      </div>
    </div>
  </div>
</header>


  <div id="content">
    <!-- Se cargan UNA sola vez. Luego solo se ocultan/muestran -->
    <iframe id="frameFotos" class="viewframe" src="./fotos.html"></iframe>
    <iframe id="frameVideos" class="viewframe hidden" src="./videosSesion2.html"></iframe>
  </div>

  <script>
    const tabFotos = document.getElementById('tabFotos');
    const tabVideos = document.getElementById('tabVideos');
    const frameFotos = document.getElementById('frameFotos');
    const frameVideos = document.getElementById('frameVideos');

 const actionsFotos  = document.getElementById('actionsFotos');
const actionsVideos = document.getElementById('actionsVideos');
const feedTitle = document.getElementById('feedTitle');

function activeFrame(which){
  return which === 'videos' ? frameVideos : frameFotos;
}

/* Hace click dentro del iframe (sin romper la lógica interna) */
function clickInsideFrame(frameEl, selectors) {
  try {
    const doc = frameEl.contentWindow.document;
    for (const sel of selectors) {
      const el = doc.querySelector(sel);
      if (el) { el.click(); return true; }
    }
  } catch (e) {}
  return false;
}

/* Iniciales del usuario (solo visual) */
function syncInitials() {
  const getInitials = () => {
    const name =
      (localStorage.getItem("autor") ||
       localStorage.getItem("userName") ||
       "Usuario").trim();
    const ini = name.split(" ").map(w => w[0]).join("").slice(0,2).toUpperCase();
    return ini || "U";
  };
  const ini = getInitials();
  document.getElementById('feedUserBtnFotos').textContent = ini;
  document.getElementById('feedUserBtnVideos').textContent = ini;
}

function show(which){
  const isFotos = which === 'fotos';

  // Iframes (NO se recargan)
  frameFotos.classList.toggle('hidden', !isFotos);
  frameVideos.classList.toggle('hidden', isFotos);

  // Tabs
  tabFotos.classList.toggle('selected', isFotos);
  tabVideos.classList.toggle('selected', !isFotos);

  // Header “dinámico”
  actionsFotos.style.display  = isFotos ? 'flex' : 'none';
  actionsVideos.style.display = isFotos ? 'none' : 'flex';
  feedTitle.textContent = 'DECOM';

  localStorage.setItem('decom_tab', which);

  // Opcional: al ir a fotos, manda mensaje para que videos pause si tienes listener
  if (isFotos) {
    try { frameVideos.contentWindow.postMessage({ type:'DECOM_HIDE_VIDEOS' }, '*'); } catch(e){}
  }
}

syncInitials();
window.addEventListener('storage', syncInitials);


    tabFotos.addEventListener('click', () => show('fotos'));
    tabVideos.addEventListener('click', () => show('videos'));

    // ---- BOTONES FOTOS (delegan a botones reales dentro de fotos.html) ----
document.getElementById('feedPublishBtnFotos').addEventListener('click', (e) => {
  e.preventDefault();
  // intenta id primero y luego fallback por selector
  clickInsideFrame(frameFotos, ['#publishBtn', '[id="publishBtn"]', '.publish-btn', 'button[title*="Public"]']);
});

document.getElementById('feedBuscarBtnFotos').addEventListener('click', (e) => {
  e.preventDefault();
  clickInsideFrame(frameFotos, ['#btnBuscar', '[id="btnBuscar"]', '.search-btn', 'button[title*="Buscar"]']);
});

document.getElementById('feedUserBtnFotos').addEventListener('click', (e) => {
  e.preventDefault();
  clickInsideFrame(frameFotos, ['#userBtn', '[id="userBtn"]', '.user-btn']);
});


// ---- BOTONES VIDEOS (delegan a botones reales dentro de videosSesion2.html) ----
document.getElementById('feedPublishBtnVideos').addEventListener('click', (e) => {
  e.preventDefault();
  clickInsideFrame(frameVideos, ['#publishBtn', '[id="publishBtn"]', '.publish-btn', 'button[title*="Public"]']);
});

document.getElementById('feedBuscarBtnVideos').addEventListener('click', (e) => {
  e.preventDefault();
  clickInsideFrame(frameVideos, ['#btnBuscar', '[id="btnBuscar"]', '.search-btn', 'button[title*="Buscar"]']);
});

document.getElementById('feedUserBtnVideos').addEventListener('click', (e) => {
  e.preventDefault();
  clickInsideFrame(frameVideos, ['#userBtn', '[id="userBtn"]', '.user-btn']);
});


    // restaurar pestaña
    const saved = localStorage.getItem('decom_tab');
    if (saved === 'videos') show('videos');
  </script>
</body>
</html>
